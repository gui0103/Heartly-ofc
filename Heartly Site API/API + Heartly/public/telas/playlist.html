<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../telas/playlist.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=PT+Sans&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="icon" href="../imgs/Logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Fugaz+One&display=swap" rel="stylesheet">
    <title>Playlist</title>
</head>

<body>
    <!-- Header -->
    <div class="header">
        <div class="caixa">
            <a href="../index.html"><img class="logo" src="../imgs/logo_music.png"
                    alt="Logo da heartly na cor rosa claro"></a>
            <nav>
                <b>
                    <ul>
                        <a href="../index.html">
                            <li>HOME</li>
                        </a>
                        <a href="../telas/emalta.html">
                            <li>EM ALTA</li>
                        </a>
                        <a href="../telas/cadastro.html">
                            <li>CADASTRO</li>
                        </a>
                        <a href="../telas/perfil_Logado.html">
                            <li>MEU PERFIL</li>
                        </a>
                    </ul>
                </b>
            </nav>
        </div>
    </div>

    <!-- Content -->
    <div class="title">
        <b>MONTE SUA PLAYLIST</b>
    </div>
    <div class="box_pai">

        <!-- Songs -->
        <div class="box_divisoria1">
            <div class="box_fileira2">
                <div class="box_titulo1">
                    <img id="img1" src="../imgs/plus.png" onclick="adicionar(1)">
                    <b class="box_song_text"> CASTLE ON THE HILL <br> ED SHEERAN</b>
                </div>
                <div class="box_titulo2">
                    <img id="img3" src="../imgs/plus.png" onclick="adicionar(3)">
                    <b class="box_song_text"> GALWAY GIRL <br> ED SHEERAN</b>
                </div>
            </div>
            <div class="box_fileira2">
                <div class="box_titulo1">
                    <img id="img5" src="../imgs/plus.png" onclick="adicionar(5)">
                    <b class="box_song_text"> NEW MAN <br> ED SHEERAN</b>
                </div>
                <div class="box_titulo2">
                    <img id="img7" src="../imgs/plus.png" onclick="adicionar(7)">
                    <b class="box_song_text"> SHAPE OF YOU <br> ED SHEERAN</b>
                </div>
            </div>
            <div class="box_fileira2">
                <div class="box_titulo1">
                    <img id="img9" src="../imgs/plus.png" onclick="adicionar(9)">
                    <b class="box_song_text"> FINE LINE <br> HARRY STYLES</b>
                </div>
                <div class="box_titulo2">
                    <img id="img10" src="../imgs/plus.png" onclick="adicionar(10)">
                    <b class="box_song_text"> GOLDEN <br> HARRY STYLES</b>
                </div>
            </div>
            <div class="box_fileira2">
                <div class="box_titulo1">
                    <img id="img11" src="../imgs/plus.png" onclick="adicionar(11)">
                    <b class="box_song_text"> LIGHTS UP <br> HARRY STYLES</b>
                </div>
                <div class="box_titulo2">
                    <img id="img15" src="../imgs/plus.png" onclick="adicionar(15)">
                    <b class="box_song_text"> WATERMELON SUGAR <br> HARRY STYLES</b>
                </div>
            </div>
            <div class="box_fileira2">
                <div class="box_titulo1">
                    <img id="img17" src="../imgs/plus.png" onclick="adicionar(17)">
                    <b class="box_song_text"> PAINKILLER <br> RUEL</b>
                </div>
                <div class="box_titulo2">
                    <img id="img18" src="../imgs/plus.png" onclick="adicionar(18)">
                    <b class="box_song_text"> COURAGE <br> RUEL</b>
                </div>
            </div>
            <div class="box_fileira2">
                <div class="box_titulo1">
                    <img id="img20" src="../imgs/plus.png" onclick="adicionar(20)">
                    <b class="box_song_text"> DISTANCE <br> RUEL</b>
                </div>
                <div class="box_titulo2">
                    <img id="img22" src="../imgs/plus.png" onclick="adicionar(22)">
                    <b class="box_song_text"> REAL THING <br> RUEL</b>
                </div>
            </div>
            <div class="box_fileira2">
                <div class="box_titulo1">
                    <img id="img25" src="../imgs/plus.png" onclick="adicionar(25)">
                    <b class="box_song_text"> WHY <br> SHAWN MENDES</b>
                </div>
                <div class="box_titulo2">
                    <img id="img27" src="../imgs/plus.png" onclick="adicionar(27)">
                    <b class="box_song_text"> MUTUAL <br> SHAWN MENDES</b>
                </div>
            </div>
            <div class="box_fileira2">
                <div class="box_titulo1">
                    <img id="img30" src="../imgs/plus.png" onclick="adicionar(30)">
                    <b class="box_song_text"> WHEN YOU´RE READY <br> SHAWN MENDES</b>
                </div>
                <div class="box_titulo2">
                    <img id="img31" src="../imgs/plus.png" onclick="adicionar(31)">
                    <b class="box_song_text"> FALLIN´ ALL IN YOU <br> SHAWN MENDES</b>
                </div>
            </div>
            <div class="box_fileira2">
                <div class="box_titulo1">
                    <img id="img32" src="../imgs/plus.png" onclick="adicionar(32)">
                    <b class="box_song_text"> PERFECLY WRONG <br> SHAWN MENDES</b>
                </div>
                <div class="box_titulo2">
                    <img id="img34" src="../imgs/plus.png" onclick="adicionar(34)">
                    <b class="box_song_text"> DREAM <br> SHAWN MENDES</b>
                </div>
            </div>
            <div class="box_fileira2">
                <div class="box_titulo1">
                    <img id="img36" src="../imgs/plus.png" onclick="adicionar(36)">
                    <b class="box_song_text"> SONG FOR NO ONE <br> SHAWN MENDES</b>
                </div>
                <div class="box_titulo2">
                    <img id="img37" src="../imgs/plus.png" onclick="adicionar(37)">
                    <b class="box_song_text"> WONDER <br> SHAWN MENDES</b>
                </div>
            </div>
            <div class="box_fileira2">
                <div class="box_titulo1">
                    <img id="img42" src="../imgs/plus.png" onclick="adicionar(42)">
                    <b class="box_song_text"> LOVER REMIX <br> TAYLOR SWIFT</b>
                </div>
                <div class="box_titulo2">
                    <img id="img43" src="../imgs/plus.png" onclick="adicionar(43)">
                    <b class="box_song_text"> WILDEST DREAMS <br> TAYLOR SWIFT</b>
                </div>
            </div>
            <div class="box_fileira2">
                <div class="box_titulo1">
                    <img id="img51" src="../imgs/plus.png" onclick="adicionar(51)">
                    <b class="box_song_text"> I DID SOMETHING BAD <br> TAYLOR SWIFT</b>
                </div>
                <div class="box_titulo2">
                    <img id="img59" src="../imgs/plus.png" onclick="adicionar(59)">
                    <b class="box_song_text"> HIGHEST IN THE ROOM <br> TRAVIS SCOTT</b>
                </div>
            </div>
        </div>

        <!-- Songs -->
        <div class="box_divisoria2">
            <div class="box_fileira">
                <div class="box_song">
                    <b class="box_song_text" id="titulo1">CASTLE ON THE HILL <br> - ED SHEERAN -</b> <br> <br>
                    <audio id="1" onplay="play_song(this.id)" src="../msc/Ed Sheeran - Castle On The Hill(MP3_160K).mp3"
                        controls loop> </audio>
                </div>
                <div class="box_song2">
                    <b class="box_song_text" id="titulo2">DIVE <br> - ED SHEERAN -</b> <br> <br>
                    <audio id="2" onplay="play_song(this.id)" src="../msc/Ed Sheeran - Dive(MP3_160K).mp3" controls
                        loop>
                    </audio>
                </div>
            </div>
            <div class="box_fileira">
                <div class="box_song">
                    <b class="box_song_text" id="titulo3">GALWAY GIRL <br> - ED SHEERAN -</b> <br> <br>
                    <audio id="3" onplay="play_song(this.id)" src="../msc/Ed Sheeran - Galway Girl (MP3_160K).mp3"
                        controls loop> </audio>
                </div>
                <div class="box_song2">
                    <b class="box_song_text" id="titulo4">NANCY MULLIGAN <br> - ED SHEERAN -</b> <br> <br>
                    <audio id="4" onplay="play_song(this.id)" src="../msc/Ed Sheeran - Nancy Mulligan (MP3_160K).mp3"
                        controls loop> </audio>
                </div>
            </div>

            <div class="box_fileira">
                <div class="box_song">
                    <b class="box_song_text" id="titulo5">NEW MAN <br> - ED SHEERAN -</b> <br> <br>
                    <audio id="5" onplay="play_song(this.id)" src="../msc/Ed Sheeran - New Man (MP3_160K).mp3" controls
                        loop>
                    </audio>
                </div>
                <div class="box_song2">
                    <b class="box_song_text" id="titulo6">PERFECT <br> - ED SHEERAN -</b> <br> <br>
                    <audio id="6" onplay="play_song(this.id)" src="../msc/Ed Sheeran - Perfect (MP3_160K).mp3" controls
                        loop>
                    </audio>
                </div>
            </div>
            <div class="box_fileira">
                <div class="box_song">
                    <b class="box_song_text" id="titulo7">SHAPE OF YOU <br> - ED SHEERAN -</b> <br> <br>
                    <audio id="7" onplay="play_song(this.id)" src="../msc/Ed Sheeran - Shape of You (MP3_160K).mp3"
                        controls loop> </audio>
                </div>
                <div class="box_song2">
                    <b class="box_song_text" id="titulo8">SUPERMARKET FLOWERS <br> - ED SHEERAN -</b> <br> <br>
                    <audio id="8" onplay="play_song(this.id)"
                        src="../msc/Ed Sheeran - Supermarket Flowers (MP3_160K).mp3" controls loop> </audio>
                </div>
            </div>
        </div>
    </div>

    <div class="box_centralizadora">
        <button onclick="salvar()"><b>SALVAR PLAYLIST</b></button>
    </div>

</body>

</html>

<script>
    vt_musicas_escolhidas = [];

    vt_musicas_srcs = ["posicao0", "../msc/Ed Sheeran - Castle On The Hill(MP3_160K).mp3", "posicao2",
        "../msc/Ed Sheeran - Galway Girl (MP3_160K).mp3",
        "posicao4", "../msc/Ed Sheeran - New Man (MP3_160K).mp3",
        "posicao6", "../msc/Ed Sheeran - Shape of You (MP3_160K).mp3", "posicao8",
        "../msc/Harry Styles - Fine Line (Official Audio)(MP3_160K).mp3",
        "../msc/Harry Styles - Golden (Official Audio)(MP3_160K).mp3",
        "../msc/Harry Styles - Lights Up (Official Video)(MP3_160K).mp3",
        "posicao12", "posicao13", "posicao14", "../msc/Harry Styles - Watermelon Sugar(MP3_160K).mp3", "posicao16",
        "../msc/Painkiller(MP3_160K).mp3",
        "../msc/Ruel - courage (official audio)(MP3_160K).mp3", "posicao19",
        "../msc/Ruel - distance (official audio)(MP3_160K).mp3", "posicao21",
        "../msc/Ruel - Real Thing (Audio)(MP3_160K).mp3", "posicao23",
        "posicao24", "../msc/Why.mp3", "posicao26", "../msc/Mutual.mp3", "posicao28", "posicao29",
        "../msc/When You're Ready.mp3", "../msc/Fallin' All In You.mp3", "../msc/Perfectly Wrong.mp3", "posicao33",
        "../msc/Dream(MP3_160K).mp3", "posicao35",
        "../msc/Song For No One(MP3_160K).mp3", "../msc/Wonder(MP3_160K).mp3", "posicao38", "posicao39",
        "posicao40", "posicao41", "../msc/Taylor Swift - Lover Remix Feat. Shawn Mendes(MP3_160K).mp3",
        "../msc/Taylor Swift - Wildest Dreams(MP3_160K).mp3", "posicao44", "posicao45", "posicao46", "posicao47",
        "posicao48",
        "posicao49", "posicao50", "../msc/I Did Something Bad(MP3_160K).mp3", "posicao52", "posicao53", "posicao54",
        "posicao55", "posicao56", "posicao57", "posicao58",
        "../msc/Travis Scott - HIGHEST IN THE ROOM(MP3_160K).mp3"
    ];

    vt_musicas_titulos = ["posicao0", "Castle On The Hill <br> - Ed Sheeran -", "posicao2",
        "Galway Girl <br> - Ed Sheeran -",
        "posicao4", "New Man <br> - Ed Sheeran -",
        "posicao6", "Shape of You <br> - Ed Sheeran -", "posicao8",
        "Fine Line <br> - Harry Styles -",
        "Golden <br> - Harry Styles -",
        "Lights Up <br> - Harry Styles -",
        "posicao12", "posicao13", "posicao14", "Watermelon Sugar <br> - Harry Styles -", "posicao16",
        "Painkiller <br> - Ruel -",
        "Courage <br> - Ruel -", "posicao19",
        "Distance <br> - Ruel -", "posicao21",
        "Real Thing <br> - Ruel -", "posicao23",
        "posicao24", "Why <br> - Shawn Mendes -", "posicao26", "Mutual <br> - Shawn Mendes -", "posicao28",
        "posicao29",
        "When You're Ready <br> - Shawn Mendes -", "Fallin' All In You <br> - Shawn Mendes -",
        "Perfectly Wrong <br> - Shawn Mendes -", "posicao33",
        "Dream <br> - Shawn Mendes -", "posicao35",
        "Song For No One <br> - Shawn Mendes -", "Wonder <br> - Shawn Mendes -", "posicao38", "posicao39",
        "posicao40", "posicao41", "Lover Remix <br> - Taylor Swift -",
        "Wildest Dreams <br> - Taylor Swift -", "posicao44", "posicao45", "posicao46", "posicao47", "posicao48",
        "posicao49", "posicao50", "I Did Something Bad <br> - Taylor Swift -", "posicao52", "posicao53",
        "posicao54",
        "posicao55", "posicao56", "posicao57", "posicao58", "HIGHEST IN THE ROOM <br> - Travis Scott -"
    ];

    tamanho_cont = 0;

    // Conexão com o Banco de Dados
    var vt_fkUsuario = sessionStorage.getItem('idUsuario_usuario_meuapp');
    var vt_nomeUsuario = sessionStorage.getItem('nomeUsuario_usuario_meuapp');

    verificar_login()

    function verificar_session() {

        fetch(`/usuarios/sessao/${vt_nomeUsuario}`, {
                cache: 'no-store'
            })
            .then(resposta => {
                if (resposta.ok) {
                    resposta.text().then(texto => {
                        console.log('Session :slight_smile: ', texto);
                    });
                } else {
                    console.error('Session :.( ');
                    sair();
                }
            });

    }

    function verificar_login() {

        if (vt_fkUsuario == null) {
            window.location.href = 'login.html';
        } else {
            verificar_session();

            /* Soma quantas músicas o usuário ouviu */
            fetch(`/musica/mostrarMusicasOuvidasTotal/${vt_fkUsuario}`, {
                method: "POST"
            }).then(resposta => {

                if (resposta.ok) {
                    resposta.json().then(json => {
                        console.log(json[0].soma);
                        total_ouvidas.innerHTML = json[0].soma;

                    })
                    console.log('funcionou');

                } else {

                    console.log('Erro!');

                    resposta.text().then(texto => {
                        console.error(texto);
                    });
                }
            });

        }
    }

    // Adiciona a música na playlist
    function adicionar(musica_selecionada) {

        if (tamanho_cont < 8) {
            tamanho_cont++;
            vt_musicas_escolhidas.push(musica_selecionada);
        } else {
            alert('Você não pode adicionar mais de 8 músicas na playlist!');
        }

    }

    // Salva a playlist
    function salvar() {
        if (tamanho_cont < 8) {
            alert(`Você adicionou ${tamanho_cont} músicas, por favor adicione mais ${8 - tamanho_cont} músicas!`);
        }

        for (let index = 0; index < 8; index++) {
        document.getElementById(`${index + 1}`).src = `${vt_musicas_srcs[vt_musicas_escolhidas[index]]}`;

        document.getElementById(`titulo${index + 1}`).innerHTML = `${vt_musicas_titulos[vt_musicas_escolhidas[index]].toUpperCase()}`;
 
        }

        var musica_escolhida_0 = vt_musicas_escolhidas[0];
        var musica_escolhida_1 = vt_musicas_escolhidas[1];
        var musica_escolhida_2 = vt_musicas_escolhidas[2];
        var musica_escolhida_3 = vt_musicas_escolhidas[3];
        var musica_escolhida_4 = vt_musicas_escolhidas[4];
        var musica_escolhida_5 = vt_musicas_escolhidas[5];
        var musica_escolhida_6 = vt_musicas_escolhidas[6];
        var musica_escolhida_7 = vt_musicas_escolhidas[7];

        fetch(`/musica/mudarPlaylist/${musica_escolhida_0}/${musica_escolhida_1}/${musica_escolhida_2}/${musica_escolhida_3}/${musica_escolhida_4}/${musica_escolhida_5}/${musica_escolhida_6}/${musica_escolhida_7}/${vt_fkUsuario}`, {
            method: "POST"
        }).then(resposta => {

            if (resposta.ok) {

                console.log('Mudar Playlist ok!');

            } else {

                console.log('Erro em Mudar Playlist!');

                resposta.text().then(texto => {
                    console.error(texto);
                });
            }
        });

        return false;
    }


    // Faz a música selecionada tocar e as outras pararem de tocar
    function play_song(audio_clicado) {
        for (var pausar = 1; pausar <= 8; pausar++) {
            document.getElementById(`${audio_clicado}`).volume = 0.15;
            document.getElementById(`${audio_clicado}`).play();
            if (pausar != audio_clicado) {
                document.getElementById(`${pausar}`).pause();
                document.getElementById(`${pausar}`).load();
            }
        }
    }

    fetch(`/musica/mudarNomesPlaylist/${vt_fkUsuario}`, {
        method: "GET"
    }).then(resposta => {

        if (resposta.ok) {

            resposta.json().then(json => {

                for (let index = 0; index < 8; index++) {

                    var musicaNome = vt_musicas_titulos[json[index].fkMusica];
                    var musicaSrc = vt_musicas_srcs[json[index].fkMusica];

                    document.getElementById(`titulo${index + 1}`).innerHTML =
                        `${musicaNome.toUpperCase()}`;

                    document.getElementById(`${index + 1}`).src =
                        `${musicaSrc}`;
                }


            })

        } else {

            console.log('Erro em Mudar nomes das músicas Playlist!');

            resposta.text().then(texto => {
                console.error(texto);
            });
        }
    });

</script>